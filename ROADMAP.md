# Roadmap: dotfiles-nvim

Custom Neovim configuration built from scratch for understanding every piece.
Inspired by [LazyVim](https://github.com/LazyVim/LazyVim) and
[LunarVim](https://github.com/LunarVim/LunarVim), but intentionally not a
distribution -- a personal config you fully own and understand.

---

## Principles

- **Build to understand.** If a feature can be written by hand in reasonable
  effort, write it yourself instead of reaching for a plugin.
- **Incremental delivery.** One feature per task. Test it, understand it, then
  move on.
- **Native-first.** Prefer Neovim 0.11+ built-in APIs (LSP via `vim.lsp.config`,
  formatting via LSP, diagnostics via `vim.diagnostic`) over wrapper plugins.
- **Matugen-driven theming.** Wallpaper-derived Material You colorscheme
  generated by [matugen](https://github.com/InioX/matugen), integrated with
  Hyprland for a unified desktop palette.

---

## Decisions

| Area            | Choice                                              | Why                                                        |
|-----------------|-----------------------------------------------------|------------------------------------------------------------|
| Plugin manager  | lazy.nvim (keep)                                    | Already set up, industry standard                          |
| Theming         | matugen + base16-nvim hybrid                        | Material You colors from wallpaper, hot-reload via SIGUSR1 |
| Completion      | blink.cmp                                           | Best AI + LSP + snippet integration, fast Rust core        |
| Statusline      | lualine.nvim                                        | Solid plugin, easy to theme with matugen palette           |
| Bufferline      | bufferline.nvim                                     | Buffer tabs with diagnostics, sorting, close buttons       |
| File explorer   | nvim-tree (keep + improve)                          | Already configured, familiar                               |
| Fuzzy finder    | telescope.nvim (keep + improve)                     | Already configured, huge extension ecosystem               |
| Git             | gitsigns.nvim + DIY lazygit float                   | Plugin for gutter, hand-written floating terminal for git   |
| Dashboard       | snacks.nvim                                         | Already installed (opencode dep), zero new dependencies    |
| LSP install     | mason.nvim (installer only)                         | Portable tool installation, no mason-lspconfig bridge      |
| LSP config      | Native `vim.lsp.config` / `vim.lsp.enable` (0.11+)  | No lspconfig plugin needed, full control                   |
| Formatting      | LSP-only                                            | Simpler, no conform.nvim                                   |
| Linting         | LSP diagnostics only                                | Simpler, no nvim-lint                                      |
| Debugging       | nvim-dap + nvim-dap-ui                              | Full DAP support from the start                            |
| Keymap discovery| which-key.nvim                                      | Essential for learning your own keymaps                    |
| Jump / search   | flash.nvim                                          | Labeled jumps, treesitter selection                        |
| Auto-pairs      | DIY (write your own)                                | Learning exercise in insert-mode APIs                      |
| TODO highlights | todo-comments.nvim                                  | Telescope integration, minimal config                      |
| Desktop         | Hyprland / Wayland                                  | Native matugen integration                                 |

---

## Target Architecture

```
~/.config/nvim/
├── init.lua                       # Entry point
├── lua/
│   ├── config/
│   │   ├── common.lua             # Core editor options
│   │   ├── keymaps.lua            # [NEW] Global keymaps (split from common)
│   │   ├── autocmds.lua           # [NEW] Global autocommands
│   │   ├── diagnostics.lua        # [NEW] Diagnostic display config
│   │   ├── lazy.lua               # lazy.nvim bootstrap
│   │   └── terminal.lua           # Shell / terminal config
│   ├── lsp/
│   │   ├── python/                # ruff, ty, pyright (existing)
│   │   ├── lua/                   # [NEW] lua_ls
│   │   ├── rust/                  # [NEW] rust-analyzer
│   │   ├── clangd/                # [NEW] clangd
│   │   ├── typescript/            # [NEW] ts_ls or vtsls
│   │   ├── html_css/              # [NEW] html, cssls, emmet
│   │   └── cmake/                 # [NEW] neocmakelsp, taplo
│   ├── plugins/
│   │   ├── colorscheme.lua        # [REPLACE] matugen + base16 (was everforest)
│   │   ├── nvim-tree.lua          # [IMPROVE] git icons, layout, auto-close
│   │   ├── telescope.lua          # [IMPROVE] layout, ignore patterns, keymaps
│   │   ├── nvim-treesitter.lua    # [IMPROVE] all languages, textobjects
│   │   ├── trouble.lua            # (keep as-is)
│   │   ├── LuaSnip.lua            # (keep as-is)
│   │   ├── opencode.lua           # (keep as-is)
│   │   ├── zen-mode.lua           # (keep as-is)
│   │   ├── lualine.lua            # [NEW] statusline
│   │   ├── bufferline.lua         # [NEW] buffer tabs
│   │   ├── gitsigns.lua           # [NEW] git gutter
│   │   ├── which-key.lua          # [NEW] keymap discovery
│   │   ├── flash.lua              # [NEW] jump / search
│   │   ├── todo-comments.lua      # [NEW] TODO/FIXME highlighting
│   │   ├── dap.lua                # [NEW] debugging
│   │   ├── mason.lua              # [NEW] tool installer
│   │   ├── blink-cmp.lua          # [NEW] completion engine
│   │   ├── dashboard.lua          # [NEW] start screen (snacks)
│   │   ├── cmake-tools.lua        # [NEW] CMake build integration
│   │   ├── persistence.lua        # [NEW] session save/restore
│   │   ├── telescope-undo.lua     # [NEW] undo tree visualization
│   │   └── markview.lua           # [NEW] in-buffer doc rendering
│   ├── theme/                     # [NEW] matugen integration
│   │   ├── init.lua               # Theme loading + SIGUSR1 hot-reload
│   │   └── generated.lua          # Matugen output (gitignored)
│   └── custom/                    # [NEW] hand-written features
│       ├── autopairs.lua          # DIY auto-pair brackets/quotes
│       ├── statuscolumn.lua       # DIY status column
│       ├── winbar.lua             # DIY breadcrumbs via LSP symbols
│       ├── toggles.lua            # DIY toggle utilities (<leader>u)
│       └── highlights.lua         # Custom highlight overrides for matugen
├── templates/
│   └── neovim.lua                 # [NEW] matugen template for Neovim colors
└── snippets/                      # Custom snippets (populate later)
    ├── lua/
    └── vscode/
```

---

## Phases

Phases are **not strictly sequential**. Work on whatever interests you. Each
task is tracked in Taskwarrior under `project:dotfiles-nvim` with a `+phaseN`
tag.

### Phase 1 -- Foundation Cleanup

Refactor the base config into clean, dedicated modules before adding features.

| Task | Description | Approach |
|------|-------------|----------|
| Split keymaps | Move keymaps from `common.lua` + `init.lua` into `config/keymaps.lua`. Organize by category: navigation, editing, buffers, windows. | DIY |
| Create autocmds | New `config/autocmds.lua` with essentials: highlight yank, auto-resize splits, restore cursor position, close help/qf with `q`, auto-create parent dirs on save. | DIY |
| Expand options | Improve `config/common.lua`: relative line numbers, global statusline (`laststatus=3`), `scrolloff=8`, smartcase search, persistent undo, better format options. | DIY |
| Configure diagnostics | New `config/diagnostics.lua`: custom sign icons (Nerd Font), virtual text style, floating window borders, severity-based sorting. | DIY |

**Inspiration:**
- LazyVim `config/keymaps.lua`, `config/autocmds.lua`, `config/options.lua`
- LunarVim `keymappings.lua`, `core/autocmds.lua`, `config/settings.lua`

---

### Phase 2 -- Theming with Matugen

Replace everforest with a wallpaper-derived Material You colorscheme.

| Task | Description | Approach |
|------|-------------|----------|
| Set up matugen | Install matugen CLI, create `templates/neovim.lua` template mapping Material You color roles to base16 slots, configure `~/.config/matugen/config.toml` to output to `lua/theme/generated.lua`. | DIY + CLI |
| Create theme module | Write `lua/theme/init.lua`: load generated colors via base16-nvim, handle `SIGUSR1` signal autocmd for live hot-reload when wallpaper changes. Add `base16-nvim` plugin spec. | DIY + Plugin |
| Custom highlight overrides | Write `lua/custom/highlights.lua`: ensure telescope, nvim-tree, trouble, treesitter, diagnostics, and diff colors look correct with the generated palette. | DIY |
| Cutover from everforest | Replace everforest plugin spec with matugen colorscheme as default. Update `lazy.lua` install colorscheme fallback. | Config |

**Key links:**
- [matugen](https://github.com/InioX/matugen)
- [matugen-themes (Neovim template)](https://github.com/InioX/matugen-themes/tree/main/templates/neovim)
- [base16-nvim](https://github.com/RRethy/base16-nvim)
- Neovim `Signal` autocmd for SIGUSR1 hot-reload

---

### Phase 3 -- Git Integration

| Task | Description | Approach |
|------|-------------|----------|
| Add gitsigns.nvim | Gutter signs, inline blame, hunk navigation (`]h`/`[h`), hunk stage/reset/preview. | Plugin |
| DIY lazygit float | Write a keybind (`<leader>gg`) that opens lazygit in a floating terminal using `vim.fn.termopen` -- no toggleterm plugin needed. | DIY |

**Inspiration:**
- LazyVim `plugins/editor.lua` (gitsigns config)
- LunarVim `core/gitsigns.lua`, `core/terminal.lua` (lazygit via toggleterm)

---

### Phase 4 -- Improve Existing Plugins

Harden the plugins already in the config.

| Task | Description | Approach |
|------|-------------|----------|
| Remake nvim-tree | Fix layout issues, add git status icons, auto-close on last window, better keymaps (create/rename/delete), hidden file toggle. | Config |
| Improve telescope | Better layout (horizontal for wide screens), `file_ignore_patterns`, preview window tuning, send results to quickfix (`<C-q>`), buffer delete from picker. | Config |
| Expand treesitter | Fix `"javacript"` typo. Add all target languages: rust, c, cpp, javascript, typescript, tsx, html, css, json, toml, just, cmake, lua, python, vim, vimdoc, markdown, regex, bash. Add `nvim-treesitter-textobjects` for function/class navigation (`]f`/`[f`, `]c`/`[c`). Enable treesitter-based indent and folding. | Config + Plugin |

---

### Phase 5 -- UI Enhancements

| Task | Description | Approach |
|------|-------------|----------|
| Add lualine.nvim | Statusline with: mode, git branch, filename, diagnostics count, LSP server name, encoding, file position. Theme with matugen colors via `base16` lualine theme. | Plugin |
| Add bufferline.nvim | Buffer tabs in the tabline. Show diagnostics icons, close buttons, modified indicator. Sort by directory or extension. | Plugin |
| DIY statuscolumn | Custom `statuscolumn` option: relative line numbers, gitsigns integration column, diagnostic sign column, fold markers. | DIY |
| DIY winbar | Custom `winbar` showing file path + LSP document symbols (breadcrumbs) using `vim.lsp.buf.document_symbol`. | DIY |
| Configure dashboard | Set up snacks.nvim dashboard section: recent files, quick actions (new file, find file, live grep, config, quit), project shortcuts. | Config |

**Inspiration:**
- LazyVim `plugins/ui.lua` (lualine, bufferline, noice, snacks dashboard)
- LunarVim `core/lualine/`, `core/bufferline.lua`, `core/alpha.lua`

---

### Phase 6 -- Editor Essentials

| Task | Description | Approach |
|------|-------------|----------|
| Add which-key.nvim | Organize all `<leader>` keymaps into named groups: `f` = find, `g` = git, `l` = LSP, `x` = diagnostics, `d` = debug, `u` = toggles, `b` = buffers. | Plugin |
| DIY auto-pairs | Write a custom module that inserts matching `)`, `]`, `}`, `"`, `'` on open char, skips the closing char if cursor is on it, and handles backspace deletion of empty pairs. Great exercise in `vim.keymap.set` with `expr = true` callbacks. | DIY |
| Add flash.nvim | Labeled jump motions, enhanced `/` and `?` search, treesitter-based incremental selection. | Plugin |
| DIY toggle utilities | Write `<leader>u` toggle functions for: line wrap, relative/absolute numbers, diagnostics on/off, inlay hints, spell check, treesitter highlighting. Display state via `vim.notify`. | DIY |
| Add todo-comments.nvim | Highlight `TODO`, `FIXME`, `HACK`, `BUG`, `NOTE` in comments with distinct colors. Integrate with telescope (`<leader>ft` to search TODOs). | Plugin |

---

### Phase 7 -- LSP Expansion

All LSP configs use the native Neovim 0.11+ API (`vim.lsp.config` /
`vim.lsp.enable`). Mason is used only as a binary installer.

| Task | Description | Approach |
|------|-------------|----------|
| Add mason.nvim | Installer-only setup. No mason-lspconfig bridge. Use `:MasonInstall` to install tools, `vim.lsp.config` for all configuration. | Plugin |
| lua_ls | `lua/lsp/lua/lua_ls.lua` -- configure Neovim runtime paths in workspace library, handle `vim` global, set diagnostics for undefined globals. | DIY |
| rust-analyzer | `lua/lsp/rust/rust_analyzer.lua` -- cargo integration, inlay hints (types, parameters, chaining), clippy as check command. | DIY |
| clangd | `lua/lsp/clangd/clangd.lua` -- `compile_commands.json` detection, header source switching, fallback flags. | DIY |
| TypeScript | `lua/lsp/typescript/ts_ls.lua` -- JS, TS, JSX, TSX support. Consider vtsls as alternative. | DIY |
| HTML / CSS / Emmet | `lua/lsp/html_css/` -- html-lsp, cssls, emmet_ls for fast HTML expansion. | DIY |
| CMake + TOML | neocmakelsp for CMakeLists.txt (faster, richer than cmake-language-server), cmake-tools.nvim for build integration, taplo for TOML files. | DIY + Plugin |

**Target languages:** Lua, Python, Rust, C/C++, JavaScript/TypeScript,
HTML/CSS, CMake, TOML, Just.

---

### Phase 8 -- Completion

| Task | Description | Approach |
|------|-------------|----------|
| Add blink.cmp | LSP completion source, LuaSnip adapter for snippet expansion, buffer and path sources. Configure keymaps (`<C-n>`/`<C-p>` navigate, `<CR>` confirm, `<C-space>` trigger). | Plugin |
| AI completion source | Configure blink.cmp source for opencode / copilot suggestions inline. | Config |

**Why blink.cmp:** Rust-based fuzzy matching core, simpler config than
nvim-cmp, first-class snippet and AI source support, LazyVim default.

---

### Phase 9 -- Debugging

| Task | Description | Approach |
|------|-------------|----------|
| Set up nvim-dap + UI | Core DAP plugin + nvim-dap-ui for visual debugging. Keymaps under `<leader>d`: continue, step over, step into, step out, breakpoint toggle, REPL, hover. | Plugin |
| Configure adapters | codelldb for Rust/C/C++, debugpy for Python. Install via Mason. | Config |

---

### Phase 10 -- System Integration

| Task | Description | Approach |
|------|-------------|----------|
| Full matugen + Hyprland pipeline | Wallpaper change triggers matugen, which regenerates colors for Neovim + Hyprland + terminal (Alacritty/Kitty/Ghostty) + Waybar + any other apps. Neovim picks up changes via SIGUSR1 signal. | DIY (system) |

---

### Phase 11 -- Workspace & History

Manage sessions, projects, and undo history for a persistent editing experience.

| Task | Description | Approach |
|------|-------------|----------|
| Add persistence.nvim | Auto-save and restore sessions (buffers, layout, cursor position) per directory. Keybind to restore last session (`<leader>qs`), stop session (`<leader>qd`). | Plugin |
| Configure persistent undo | Enable `undofile` in options (if not already), set `undodir`, ensure `.undodir/` is gitignored. | DIY |
| Add telescope-undo.nvim | Visual undo tree via telescope picker (`<leader>fu`). Browse undo history, preview diffs, restore to any point. | Plugin |

**Key links:**
- [persistence.nvim](https://github.com/folke/persistence.nvim)
- [telescope-undo.nvim](https://github.com/debugloop/telescope-undo.nvim)

---

### Phase 12 -- Documentation Languages

Expand the config for writing documentation, notes, and technical content beyond
Markdown. Add LSPs, treesitter parsers, and in-buffer rendering.

| Task | Description | Approach |
|------|-------------|----------|
| Add marksman LSP | Markdown LSP for link completion, TOC, references. Configure via `vim.lsp.config`, install via Mason. | DIY |
| Add markview.nvim | Universal in-buffer renderer for Markdown, LaTeX math, Typst, HTML. Concealed rendering without leaving the editor. | Plugin |
| Add Typst support | Install `tinymist` LSP via Mason, add `typst` treesitter parser. | DIY |
| Add LaTeX support | Install `texlab` LSP via Mason, add `latex` treesitter parser. | DIY |
| Add prose tooling | Spell-check (`spell` + aspell/hunspell), grammar via `vale` or `ltex-ls`, wired through LSP diagnostics. | DIY + Plugin |

**Key links:**
- [marksman](https://github.com/artempyanykh/marksman)
- [markview.nvim](https://github.com/OXY2DEV/markview.nvim)
- [tinymist (Typst LSP)](https://github.com/Myriad-Dreamin/tinymist)
- [texlab (LaTeX LSP)](https://github.com/latex-lsp/texlab)
- [vale (prose linter)](https://github.com/errata-ai/vale)

---

## DIY vs Plugin Summary

Features you will **write yourself** (12 tasks):
- Keymaps module
- Autocmds module
- Editor options
- Diagnostics config
- Lazygit floating terminal
- Status column
- Winbar / breadcrumbs
- Auto-pairs
- Toggle utilities
- Highlight overrides for matugen
- Persistent undo configuration
- Prose tooling (spell, grammar)

Features handled by **plugins** (31 tasks):
- Theming bridge (base16-nvim), lualine, bufferline, gitsigns, which-key,
  flash, todo-comments, blink.cmp, nvim-dap, mason, persistence.nvim,
  telescope-undo.nvim, cmake-tools.nvim, markview.nvim, and all LSP server
  configs (including marksman, tinymist, texlab).

---

## Key References

| Resource | URL |
|----------|-----|
| LazyVim (inspiration) | https://github.com/LazyVim/LazyVim |
| LunarVim (inspiration) | https://github.com/LunarVim/LunarVim |
| awesome-neovim | https://github.com/rockerBOO/awesome-neovim |
| matugen | https://github.com/InioX/matugen |
| matugen-themes | https://github.com/InioX/matugen-themes |
| base16-nvim | https://github.com/RRethy/base16-nvim |
| blink.cmp | https://github.com/Saghen/blink.cmp |
| Neovim 0.11 LSP API | https://neovim.io/doc/user/lsp.html |
| lazy.nvim | https://lazy.folke.io/ |
| Taskwarrior (task tracking) | https://taskwarrior.org/ |
| persistence.nvim | https://github.com/folke/persistence.nvim |
| telescope-undo.nvim | https://github.com/debugloop/telescope-undo.nvim |
| cmake-tools.nvim | https://github.com/Civitasv/cmake-tools.nvim |
| neocmakelsp | https://github.com/neocmakelsp/neocmakelsp |
| markview.nvim | https://github.com/OXY2DEV/markview.nvim |
| marksman | https://github.com/artempyanykh/marksman |
| tinymist (Typst LSP) | https://github.com/Myriad-Dreamin/tinymist |
| texlab (LaTeX LSP) | https://github.com/latex-lsp/texlab |
| vale (prose linter) | https://github.com/errata-ai/vale |

---

## Progress Tracking

All tasks are tracked in Taskwarrior:

```sh
# View all tasks
task project:dotfiles-nvim

# View a specific phase
task project:dotfiles-nvim +phase1

# Start working on a task
task <id> start

# Complete a task
task <id> done
```

---

## Future Enhancements

Additional items to consider after all phases are complete:

- **Notes & knowledge-base:** neorg, vimwiki, or Obsidian-compatible helpers
  for daily notes, backlinks, and templates.
- **Diagram & math rendering:** mermaid-cli for codeblock previews, KaTeX/MathJax
  for math export.
- **Additional doc formats:** AsciiDoc, reStructuredText (esbonio LSP),
  Org mode (nvim-orgmode), MDX, Djot.
- **edgy.nvim:** Window layout management (side panels, bottom panels) once
  the UI stabilizes.
